---
output:
  word_document:
    reference_docx: myref.docx
---

```{r setup, include = F}

rm(list=ls())

#Load knitr
library(knitr)

#Set some options
options(na.action='na.fail')
opts_knit$set(root.dir = '..')
opts_chunk$set(echo=FALSE,
               warning=FALSE,
               message=FALSE,
               fig.path='../Figures/',
               fig.width= 8,
               fig.height= 8,
               fig.show='asis',
               dev=c('png'))

```

```{r load and clean, include = F}

#Load and clean data
source('Scripts/Telomere parentage LOAD.r')
source('Scripts/Telomere parentage FUNCTIONS.r')
source('Scripts/Telomere parentage CLEAN.r')


```


Top quality plot of parental early life TL vs offspring TL. Based on parental juvenile TL, n = 7 points (!), h^2^ is `r round2(lm(TL~EbothTL,data=juv,na.action=na.exclude)$coefficients['EbothTL'])`. For parental adult TL, h^2^ is `r round2(lm(TL~LbothTL,data=juv,na.action=na.exclude)$coefficients['LbothTL'])`.

```{r Figure S1, fig.width=4}


Fig1A <- ggplot(juv,aes(x = EbothTL, y = TL)) +
  geom_point() +
  stat_smooth(method=lm) +
  xlab('Parental juvenile TL') +
  ylab('Offspring TL') +
  theme_lgs()

Fig1B <- ggplot(juv,aes(x = LbothTL, y = TL)) +
  geom_point() +
  stat_smooth(method=lm) +
  xlab('Parental adult TL') +
  ylab('Offspring TL') +
  theme_lgs()

multiplot(Fig1A,Fig1B)

```



Look separately for each parent. Heritability estimates are `r round2(2*lm(TL~EmumTL,data=juv,na.action=na.exclude)$coefficients['EmumTL'])` for maternal juvenile TL, `r round2(2*lm(TL~EdadTL,data=juv,na.action=na.exclude)$coefficients['EdadTL'])` for paternal juvenile TL, `r round2(2*lm(TL~LmumTL,data=juv,na.action=na.exclude)$coefficients['LmumTL'])` for maternal adult TL, and `r round2(2*lm(TL~LdadTL,data=juv,na.action=na.exclude)$coefficients['LdadTL'])` for paternal adult TL.

```{r Figure1}

Fig1A <- ggplot(subset(juv,EPP == 'Within pair'),aes(x = EmumTL, y = TL)) +
  geom_point() +
  stat_smooth(method=lm) +
  xlab('Maternal juvenile TL') +
  ylab('Offspring TL') +
  theme_lgs()
Fig1B <- ggplot(juv,aes(x = LmumTL, y = TL,col=Fledged)) +
  geom_point() +
  stat_smooth(method=lm) +
  xlab('Maternal adult TL') +
  ylab('Offspring TL') +
  theme_lgs(addlegend = T)
Fig1C <- ggplot(subset(juv,EPP == 'Within pair'),aes(x = EdadTL, y = TL, col = Fledged)) +
  geom_point() +
  stat_smooth(method=lm) +
  xlab('Paternal juvenile TL') +
  ylab('Offspring TL') +
  theme_lgs()
Fig1D <- ggplot(juv,aes(x = LdadTL, y = TL)) +
  geom_point() +
  stat_smooth(method=lm) +
  xlab('Paternal adult TL') +
  ylab('Offspring TL') +
  theme_lgs()

multiplot(Fig1A,Fig1B,Fig1C,Fig1D,layout=matrix(1:4,2,2))

```



Paternal age and offspring TL - no effects of age or lifespan. 

```{r Figure2}

Fig2A <- ggplot(subset(juv,EPP == 'Within pair'),aes(x = mumage, y = TL)) +
  geom_point() +
  stat_smooth(method=lm) +
  xlab('Maternal age at hatching') +
  ylab('Offspring TL') +
  theme_lgs() +
  annotate(geom = 'text',x = 1,y = 15000,label = 'A')

Fig2B <- ggplot(subset(juv,EPP == 'Within pair'),aes(x = mumlife, y = TL)) +
  geom_point() +
  stat_smooth(method=lm) +
  xlab('Maternal lifespan') +
  ylab('Offspring TL') +
  theme_lgs() +
  annotate(geom = 'text',x = 1,y = 15000,label = 'B')

Fig2C <- ggplot(subset(juv,EPP == 'Within pair'),aes(x = dadage, y = TL)) +
  geom_point() +
  stat_smooth(method=lm) +
  xlab('Paternal age at hatching') +
  ylab('Offspring TL') +
  theme_lgs() +
  annotate(geom = 'text',x = 1,y = 15000,label = 'C')

Fig2D <- ggplot(subset(juv,EPP == 'Within pair'),aes(x = dadage, y = TL)) +
  geom_point() +
  stat_smooth(method=lm) +
  xlab('Paternal lifespan') +
  ylab('Offspring TL') +
  theme_lgs() +
  annotate(geom = 'text',x = 1,y = 15000,label = 'D')

multiplot(Fig2A,Fig2B,Fig2C,Fig2D,layout=matrix(1:4,2,2))

```











Parental TL and offspring Sex - big effect of maternal adult TL.

```{r Figure 3}

Fig3A <- ggplot(subset(juv,EPP == 'Within pair'),aes(x = EmumTL,y = SexEstimate)) +
  geom_point(alpha=0.2) +
  stat_smooth(method = 'glm',family = 'binomial',se=T) +
  xlab('Maternal juvenile TL') +
  ylab('Proportion male offspring') +
  theme_lgs() +
  geom_abline(slope = 0,intercept = 0.5,lty=2) +  
  annotate(geom = 'text',x = 1000,y = 1.1,label = 'A')



Fig3B <- ggplot(subset(juv,EPP == 'Within pair'),aes(x = LmumTL,y = SexEstimate)) +
  geom_point(alpha=0.2) +
  stat_smooth(method = 'glm',family = 'binomial',se=T) +
  xlab('Maternal adult TL') +
  ylab('Proportion male offspring') +
  theme_lgs() +
  geom_abline(slope = 0,intercept = 0.5,lty=2) +  
  annotate(geom = 'text',x = 1000,y = 1.1,label = 'B')


Fig3C <- ggplot(subset(juv,EPP == 'Within pair'),aes(x = EdadTL,y = SexEstimate)) +
  geom_point(alpha=0.2) +
  stat_smooth(method = 'glm',family = 'binomial',se=T) +
  xlab('Paternal juvenile TL') +
  ylab('Proportion male offspring') +
  theme_lgs(addlegend = T) +
  geom_abline(slope = 0,intercept = 0.5,lty=2) +  
  annotate(geom = 'text',x = 1000,y = 1.1,label = 'C')



Fig3D <- ggplot(subset(juv,EPP == 'Within pair'),aes(x = LdadTL,y = SexEstimate)) +
  geom_point(alpha=0.2) +
  stat_smooth(method = 'glm',family = 'binomial',se=T) +
  xlab('Paternal adult TL') +
  ylab('Proportion male offspring') +
  theme_lgs() +
  geom_abline(slope = 0,intercept = 0.5,lty=2) +  
  annotate(geom = 'text',x = 1000,y = 1.1,label = 'D')


multiplot(Fig3A,Fig3B,Fig3C,Fig3D,layout=matrix(1:4,2,2))


```



Parental age and offspring sex- significant effect of paternal age - note that this seems to be mainly driven by young fathers producing more males.

```{r Figure 4}

Fig4A <- ggplot(subset(juv,EPP == 'Within pair'),aes(x = mumage,y = SexEstimate)) +
  geom_point(alpha=0.2) +
  stat_smooth(method = 'glm',family = 'binomial',se=T) +
  xlab('Maternal age at hatching') +
  ylab('Proportion male offspring') +
  theme_lgs() +
  geom_abline(slope = 0,intercept = 0.5,lty=2) +  
  annotate(geom = 'text',x = 1.1,y = 1.1,label = 'A')



Fig4B <- ggplot(subset(juv,EPP == 'Within pair'),aes(x = mumlife,y = SexEstimate)) +
  geom_point(alpha=0.2) +
  stat_smooth(method = 'glm',family = 'binomial',se=T) +
  xlab('Maternal lifespan') +
  ylab('Proportion male offspring') +
  theme_lgs() +
  geom_abline(slope = 0,intercept = 0.5,lty=2) +  
  annotate(geom = 'text',x = 1.1,y = 1.1,label = 'B')



Fig4C <- ggplot(subset(juv,EPP == 'Within pair'),aes(x = dadage,y = SexEstimate)) +
  geom_point(alpha=0.2) +
  stat_smooth(method = 'glm',family = 'binomial',se=T) +
  xlab('Paternal age at hatching') +
  ylab('Proportion male offspring') +
  theme_lgs() +
  geom_abline(slope = 0,intercept = 0.5,lty=2) +  
  annotate(geom = 'text',x = 1.1,y = 1.1,label = 'C')




Fig4D <- ggplot(subset(juv,EPP == 'Within pair'),aes(x = dadlife,y = SexEstimate)) +
  geom_point(alpha=0.2) +
  stat_smooth(method = 'glm',family = 'binomial',se=T) +
  xlab('Paternal lifespan') +
  ylab('Proportion male offspring') +
  theme_lgs() +
  geom_abline(slope = 0,intercept = 0.5,lty=2) +  
  annotate(geom = 'text',x = 1.1,y = 1.1,label = 'D')



multiplot(Fig4A,Fig4B,Fig4C,Fig4D,layout=matrix(1:4,2,2))


```



Telomere length and sex/age = female chicks have longer telomeres, but effect disappears by fledgling stage, and in face some evidence that male subadults have longer telomeres than females. Sex-specific survival?

```{r Figure S5,fig.height = 4, fig.width = 4}
FigS1 <- ggplot(dd,aes(x = Ageclass, y = TL,col = Sex)) +
  geom_boxplot(notch=T) +
  xlab('Age class') +
  ylab('Offspring TL') +
  theme_lgs()

FigS1


```


Maternal telomere length and male age effects on offspring sex ratio. Worth noting the shaded areas here, which are the confidence limits. Suggests young crap mums with young fathers produce more males, but not when they are with older fathers. Interaction isn't significant though.

```{r Figure S6,fig.width = 5, fig.height = 4}

mymed <- median(juv$dadage,na.rm=T)
juv$dadageF <- factor(ifelse(juv$dadage<5,'Young fathers','Old fathers'))


juv2 <- subset(juv,!(is.na(juv$dadageF)))

Fig4A <- ggplot(juv2,aes(x = LmumTL,y = SexEstimate,col=dadageF)) +
  geom_point(alpha=0.2) +
  stat_smooth(method = 'glm',family = 'binomial',se=T) +
  xlab('Maternal adult TL') +
  ylab('Proportion male offspring') +
  theme_lgs(addlegend=T) +
  geom_abline(slope = 0,intercept = 0.5,lty=2) +
  scale_colour_discrete(na.value = 'white')

Fig4A

```



Another look at raw data - proportion males produced and male age. Weird quadratic effect. Sample sizes are limited as we're restricted to the telomere data, but we can look at this for all data with parentage.

```{r Figure s7,fig.width =4, fig.height = 4}
mymean <- tapply(juv$SexEstimate,juv$dadage,mean)
myn <- tapply(juv$SexEstimate,juv$dadage,length)
mymean <- mymean[myn>5]

plot(mymean~names(mymean),
type = 'l',
bty = 'l',
ylab = 'Proportion males',
xlab = 'Paternal age',
ylim= c(0.2,0.8))

abline(0.5,0,lty=2)
text(x = names(myn),y = 0.25, paste('(',myn,')',sep = ''))

```



Parental TL and TQ
```{r Figure S8, fig.width = 4, fig.height = 8}

Fig4A <- ggplot(subset(juv,TQI<50000),aes(x = TQI,y = LmumTL)) +
  geom_point() +
  stat_smooth(method = 'lm',se=T) +
  xlab('Territory quality') +
  ylab('Maternal adult TL') +
  theme_lgs()
Fig4B <- ggplot(juv,aes(x = TQI,y = LdadTL)) +
  geom_point() +
  stat_smooth(method = 'lm',se=T) +
  xlab('Territory quality') +
  ylab('Paternal adult TL') +
  theme_lgs(addlegend=T) +
  geom_abline(slope = 0,intercept = 0.5,lty=2) +
  scale_colour_discrete(na.value = 'white')


multiplot(Fig4A,Fig4B)

```



