---
output:
  word_document
---
```{r setup, include = F}

rm(list=ls())

#Load knitr
library(knitr)

#Set some options
options(na.action='na.fail')
opts_knit$set(root.dir = '..')
opts_chunk$set(echo=FALSE,
               warning=FALSE,
               message=FALSE,
               fig.path='../Figures/',
               fig.width= 5,
               fig.height= 4,
               fig.show='asis',
               dev=c('png','pdf'))

```

```{r load and clean, include = F}

#Load and clean data
source('Scripts/Telomere parentage LOAD.r')
source('Scripts/Telomere parentage FUNCTIONS.r')
source('Scripts/Telomere parentage CLEAN.r')


```




**Telomere inheritance in the Seychelles warbler**


Have a look at the relationship between Parental and offspring telomere length. 

```{r Figure1,fig.height = 8}

Fig1A <- ggplot(subset(juv,EPP == 'Within pair'),aes(x = EmumTL, y = TL)) +
          geom_point() +
          stat_smooth(method=lm) +
          xlab('Mother juvenile TL') +
          ylab('Offspring TL') +
          theme_lgs()

Fig1B <- ggplot(juv,aes(x = EdadTL, y = TL)) +
          geom_point() +
          stat_smooth(method=lm) +
          xlab('Father juvenile TL') +
          ylab('Offspring TL') +
          theme_lgs()
Fig1C <- ggplot(subset(juv,EPP == 'Within pair'),aes(x = LmumTL, y = TL)) +
          geom_point() +
          stat_smooth(method=lm) +
          xlab('Mother adult TL') +
          ylab('Offspring TL') +
          theme_lgs()

Fig1D <- ggplot(juv,aes(x = LdadTL, y = TL)) +
          geom_point() +
          stat_smooth(method=lm) +
          xlab('Father adult TL') +
          ylab('Offspring TL') +
          theme_lgs()

multiplot(Fig1A,Fig1B,Fig1C,Fig1D,layout=matrix(1:4,2,2))

```




```{r Figure1A,fig.height = 8}

Fig1A <- ggplot(juv,aes(x = mumage, y = TL,col=Sex)) +
          geom_point() +
          stat_smooth(method=lm) +
          xlab('Mother age at hatching') +
          ylab('Offspring TL') +
          theme_lgs()

Fig1B <- ggplot(juv,aes(x = dadage, y = TL,col=Sex)) +
          geom_point() +
          stat_smooth(method=lm) +
          xlab('Father age at hatching') +
          ylab('Offspring TL') +
          theme_lgs()
Fig1C <- ggplot(juv,aes(x = mumlife, y = TL,col=Sex)) +
          geom_point() +
          stat_smooth(method=lm) +
          xlab('Mother lifespan') +
          ylab('Offspring TL') +
          theme_lgs()

Fig1D <- ggplot(juv,aes(x = dadage, y = TL,col=Sex)) +
          geom_point() +
          stat_smooth(method=lm) +
          xlab('Father lifespan') +
          ylab('Offspring TL') +
          theme_lgs()

multiplot(Fig1A,Fig1B,Fig1C,Fig1D,layout=matrix(1:4,2,2))

```










Run some models - In the first table, the same factors as before predict offspring telomere length, but so does maternal telomere length. In the second table nothing is significant. This could be collinearity, or it could be crappy sample size. Need to check.

```{r model}


lm2 <- lmer(TL~ dadage  + (1|mother) + (1|father) + (1|FieldPeriodID),data = juv,na.action=na.exclude)
lm2 <- standardize(lm2)
summary(lm2)

lm2 <- lmer(TL~ LmumTL + LdadTL + TQ + Ageclass + (1|mother) + (1|father) + (1|FieldPeriodID),data = juv,na.action=na.exclude)
lm2 <- standardize(lm2)
summary(lm2)

lm2 <- lmer(TL~Ageclass + EdadTL + TQ  + (1|mother) + (1|father) + (1|FieldPeriodID),data = juv,na.action=na.exclude)
lm2 <- standardize(lm2)
summary(lm2)


tapply(juv$SurvivedNext,list(juv$Sex,juv$Ageclass),mean)
tapply(juv$SurvivedNext,list(juv$Sex,juv$Ageclass),length)


boxplot(EmumTL~Ageclass,data=subset(juv,!(is.na(juv$EmumTL))))
boxplot(EdadTL~Ageclass,data=subset(juv,!(is.na(juv$EdadTL))))


insect <- tapply(dd$TL,dd$LayYear,mean,na.rm=T)
insect <- insect[!(is.nan(insect))]
sr <- tapply(dd$SexEstimate,dd$LayYear,mean)
n <- tapply(dd$SexEstimate,dd$LayYear,length)
sr <- sr[n>15]
sr <- sr[complete.cases(sr)]
sr <- sr[names(sr) %in% names(insect)]
insect <- insect[names(insect) %in% names(sr)]

plot(sr~insect)

```




Have a look at the effect of parental telomere length on offspring sex. We find that parental telomere length in the adult stage is associated with more females. However, parental telomer length in early life is has no effect on offspring sex.

```{r Figure 2,fig.width=8,fig.height=8}

Fig2A <- ggplot(juv,aes(x = EmumTL,y = SexEstimate)) +
  geom_point(alpha=0.2) +
  stat_smooth(method = 'glm',family = 'binomial',se=T) +
  xlab('Maternal juvenile TL') +
  ylab('Proportion male offspring') +
  theme_lgs() +
  geom_abline(slope = 0,intercept = 0.5,lty=2)


Fig2B <- ggplot(juv,aes(x = EdadTL,y = SexEstimate)) +
  geom_point(alpha=0.2) +
  stat_smooth(method = 'glm',family = 'binomial',se=T) +
  xlab('Paternal juvenile TL') +
  ylab('Proportion male offspring') +
  theme_lgs() +
  geom_abline(slope = 0,intercept = 0.5,lty=2)


Fig2C <- ggplot(juv,aes(x = LmumTL,y = SexEstimate)) +
  geom_point(alpha=0.2) +
  stat_smooth(method = 'glm',family = 'binomial',se=T) +
  xlab('Maternal adult TL') +
  ylab('Proportion male offspring') +
  theme_lgs(addlegend = T) +
  geom_abline(slope = 0,intercept = 0.5,lty=2)



Fig2D <- ggplot(juv,aes(x = LdadTL,y = SexEstimate)) +
  geom_point(alpha=0.2) +
  stat_smooth(method = 'glm',family = 'binomial',se=T) +
  xlab('Paternal adult TL') +
  ylab('Proportion male offspring') +
  theme_lgs() +
  geom_abline(slope = 0,intercept = 0.5,lty=2)


multiplot(Fig2A,Fig2B,Fig2C,Fig2D,layout=matrix(1:4,2,2))


```


Check to see whether this is an age effect.

```{r Figure 3,fig.width=8,fig.height=8}

Fig3A <- ggplot(juv,aes(x = mumlife,y = SexEstimate)) +
  geom_point(alpha=0.2) +
  stat_smooth(method = 'glm',family = 'binomial',se=T) +
  xlab('Maternal Lifespan') +
  ylab('Proportion male offspring') +
  theme_lgs() +
  geom_abline(slope = 0,intercept = 0.5,lty=2)



Fig3B <- ggplot(juv,aes(x = dadlife,y = SexEstimate)) +
  geom_point() +
  stat_sum() +
  stat_smooth(method = 'glm',family = 'binomial',se=T) +
  xlab('Paternal Lifespan') +
  ylab('Proportion male offspring') +
  theme_lgs() +
  geom_abline(slope = 0,intercept = 0.5,lty=2)


Fig3C <- ggplot(juv,aes(x = mumage,y = SexEstimate)) +
  geom_point(alpha=0.2) +
  stat_smooth(method = 'glm',family = 'binomial',se=T) +
  stat_sum() +
  xlab('Maternal age at hatching') +
  ylab('Proportion male offspring') +
  theme_lgs() +
  geom_abline(slope = 0,intercept = 0.5,lty=2)



Fig3D <- ggplot(juv,aes(x = dadage,y = SexEstimate)) +
  geom_point() +
  stat_smooth(method = 'glm',family = 'binomial',se=T) +
  stat_sum() +
  xlab('Paternal age at hatching') +
  ylab('Proportion male offspring') +
  theme_lgs() +
  geom_abline(slope = 0,intercept = 0.5,lty=2)


multiplot(Fig3A,Fig3B,Fig3C,Fig3D,layout=matrix(1:4,2,2))


```





Run some models - we get significant effects for paternal age, paternal TL, and maternal TL, but not maternal age
```{r models 2}

lm1 <- glmer(SexEstimate~EdadTL + (1|father)+ (1|mother),data=juv,family='binomial',na.action=na.exclude)
lm1<- standardize(lm1)
summary(lm1)

lm2 <- glmer(SexEstimate~LmumTL + (1|father)+ (1|mother),data=juv,family='binomial',na.action=na.exclude)
lm2 <- standardize(lm2)
summary(lm2)

anova(lm1,lm2)




lm1 <- glmer(SexEstimate~mumlife + (1|mother) + (1|father)
             ,data=juv,family='binomial',na.action=na.exclude)
lm1 <- standardize(lm1)
summary(lm1)


lm2 <- glmer(SexEstimate~mumage + (1|mother) + (1|father)
             ,data=juv,family='binomial',na.action=na.exclude)
lm2 <- standardize(lm2)
summary(lm2)

anova(lm1,lm2)
















```
